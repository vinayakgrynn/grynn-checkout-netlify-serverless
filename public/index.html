<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Vinayak Shopping Kart</title>


<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


<style>



.navbar-nav {
  flex-direction: row;
}
    
.nav-link {
  padding-right: .5rem !important;
  padding-left: .5rem !important;
}
    
/* Fixes dropdown menus placed on the right side */
.ml-auto .dropdown-menu {
  left: auto !important;
  right: 0px;
}



body {
  background-color: #F8F9FA;
  padding-top: 80px;
}



input {
  border-radius: 6px;
  margin-bottom: 6px;
  padding: 12px;
  border: 1px solid rgba(50, 50, 93, 0.1);
  height: 44px;
  font-size: 16px;
  width: 100%;
  background: white;
}



.show-cart li {
  display: flex;
}



.card {
  margin-bottom: 20px;
}



.card-img-top {
  width: 200px;
  height: 200px;
  align-self: center;
}



.stripe-hidden {
  display: none;
}



.stripe-form {
  width: 30vw;
  min-width: 500px;
  align-self: center;
  box-shadow: 0px 0px 0px 0.5px rgba(50, 50, 93, 0.1),
    0px 2px 5px 0px rgba(50, 50, 93, 0.1), 0px 1px 1.5px 0px rgba(0, 0, 0, 0.07);
  border-radius: 7px;
  padding: 40px;
}



.stripe-button {
  background: #5469d4;
  color: #ffffff;
  font-family: Arial, sans-serif;
  border-radius: 0 0 4px 4px;
  border: 0;
  padding: 12px 16px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: block;
  transition: all 0.2s ease;
  box-shadow: 0px 4px 5.5px 0px rgba(0, 0, 0, 0.07);
  width: 100%;
}



/* spinner/processing state, errors */
.stripe-spinner,
.stripe-spinner:before,
.stripe-spinner:after {
  border-radius: 50%;
}
.stripe-spinner {
  color: #ffffff;
  font-size: 22px;
  text-indent: -99999px;
  margin: 0px auto;
  position: relative;
  width: 20px;
  height: 20px;
  box-shadow: inset 0 0 0 2px;
  -webkit-transform: translateZ(0);
  -ms-transform: translateZ(0);
  transform: translateZ(0);
}
.stripe-spinner:before,
.stripe-spinner:after {
  position: absolute;
  content: "";
}
.stripe-spinner:before {
  width: 10.4px;
  height: 20.4px;
  background: #5469d4;
  border-radius: 20.4px 0 0 20.4px;
  top: -0.2px;
  left: -0.2px;
  -webkit-transform-origin: 10.4px 10.2px;
  transform-origin: 10.4px 10.2px;
  -webkit-animation: loading 2s infinite ease 1.5s;
  animation: loading 2s infinite ease 1.5s;
}
.stripe-spinner:after {
  width: 10.4px;
  height: 10.2px;
  background: #5469d4;
  border-radius: 0 10.2px 10.2px 0;
  top: -0.1px;
  left: 10.2px;
  -webkit-transform-origin: 0px 10.2px;
  transform-origin: 0px 10.2px;
  -webkit-animation: loading 2s infinite ease;
  animation: loading 2s infinite ease;
}


@-webkit-keyframes loading {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@keyframes loading {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}


@media only screen and (max-width: 600px) {
  form {
    width: 80vw;
  }
}


.form-check {
    display: flex;
    align-items: center;
}
.form-check-input {
    margin-top: 0px;
}



</style>



<script>
  window.console = window.console || function(t) {};
</script>

<script>
  if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
</script>


<script src="https://js.stripe.com/v3/"></script>


<script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>


</head>



<body translate="no">






<nav class="navbar navbar-expand-lg navbar-inverse bg-inverse fixed-top bg-faded">






<div id="login" data-netlify-identity-menu></div>






<ul class="navbar-nav ml-auto">

<div class="row">

<div class="col">

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#cart">Cart (<span class="total-count"></span>)</button>

<button class="clear-cart btn btn-danger">Clear Cart</button>

</div>

</div>

</ul>





</nav>




<div class="container">
<div class="row">
<div class="col">
<div class="card" style="width: 20rem;">
<img class="card-img-top" src="http://www.azspagirls.com/files/2010/09/orange.jpg" alt="Card image cap">
<div class="card-block">
<h4 class="card-title">Orange</h4>
<p class="card-text">Price: $0.5</p>
<a href="#" data-name="Orange" data-price="0.5" class="add-to-cart btn btn-primary">Add to cart</a>
</div>
</div>
</div>
<div class="col">
<div class="card" style="width: 20rem;">
<img class="card-img-top" src="http://images.all-free-download.com/images/graphicthumb/vector_illustration_of_ripe_bananas_567893.jpg" alt="Card image cap">
<div class="card-block">
<h4 class="card-title">Banana</h4>
<p class="card-text">Price: $1.22</p>
<a href="#" data-name="Banana" data-price="1.22" class="add-to-cart btn btn-primary">Add to cart</a>
</div>
</div>
</div>
<div class="col">
<div class="card" style="width: 20rem;">
<img class="card-img-top" src="https://3.imimg.com/data3/IC/JO/MY-9839190/organic-lemon-250x250.jpg" alt="Card image cap">
<div class="card-block">
<h4 class="card-title">Lemon</h4>
<p class="card-text">Price: $5</p>
<a href="#" data-name="Lemon" data-price="5" class="add-to-cart btn btn-primary">Add to cart</a>
</div>
</div>
</div>
</div>
</div>



<div class="modal fade" id="cart" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">

<h5 class="modal-title" id="ModalLabel">Secure Cart</h5>


<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>


</div>












<div class="modal-body">




<div class=" h-100 d-flex justify-content-center align-items-center">
<div class="payment-holder"></div>
</div>




<div class=" h-100 d-flex justify-content-center align-items-center">
<div class="signin-holder">

  <p class="text-left">Sign in</p>
  <p class="text-left">Have an account already?</p>
  <!-- Add a simpler button: Simple button that will open the modal.-->
  <div class="btn btn-outline-primary on-top-modal-body " data-netlify-identity-button></div>

<hr>
  <p class="text-left">New to Grynn.com?</p>
  <button type="button" class="btn btn-secondary" onclick="vGuestLogin()">Continue as guest</button>

<br>
</div>
</div>






<div class="summary-holder">

  <table class="table summary-holder-show-cart table-striped"></table>

<hr>
  <div class="">Total Price: $<span class="summary-holder-total-cart"></span></div>
<hr>
<br>

  <table class="table summary-holder-user-details table-striped"></table>

<br>

  <table class="table summary-holder-show-address table-striped"></table>

</div>






<div class="form-holder"></div>


<table class="show-cart table vCart"></table>

<div class="vCart">Total price: $<span class="total-cart vCart"></span></div>

</div>



<div class="modal-footer">

<button type="button" class="btn btn-secondary vCart" data-dismiss="modal">Close</button>

<button type="button" class="btn btn-secondary vPrevious">Back</button>

<button type="button" class="next-address btn btn-primary">Next</button>


</div>

</div>
</div>
</div>









<!-- Modal -->
<div class="modal" id="stripe-result-modal" tabindex="-1" role="dialog" aria-labelledby="stripe-result-modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">



<div class="modal-header">
      <h5 class="modal-title" id="#stripe-result-modal-long-title">Result</h5>
</div>



<div class="modal-body">

      <div class="stripe-result-modal-body">

      </div>

</div>



<div class="modal-footer">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#stripe-result-modal" data-show="false">
        Close
      </button>
</div>



    </div>
  </div>
</div>






<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>



<script src="https://cdn.jsdelivr.net/gh/fauna/faunadb-js-release@latest/faunadb-min.js"></script>



<script id="rendered-js">


// ************************************************
// Shopping Cart API
// ************************************************

var shoppingCart = function () {
  // =============================
  // Private methods and propeties
  // =============================
  cart = [];

  // Constructor
  function Item(name, price, count) {
    this.name = name;
    this.price = price;
    this.count = count;
  }



  // Save cart
  function saveCart() {
    sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
  }

  // Load cart
  function loadCart() {
    cart = JSON.parse(sessionStorage.getItem('shoppingCart'));
  }

  if (sessionStorage.getItem("shoppingCart") != null) {
    loadCart();
  }


  // =============================
  // Public methods and propeties
  // =============================
  var obj = {};

  // Add to cart
  obj.addItemToCart = function (name, price, count) {
    for (var item in cart) {
      if (cart[item].name === name) {
        cart[item].count++;
        saveCart();
        return;
      }
    }
    var item = new Item(name, price, count);
    cart.push(item);
    saveCart();
  };

  // Set count from item
  obj.setCountForItem = function (name, count) {
    for (var i in cart) {
      if (cart[i].name === name) {
        cart[i].count = count;
        break;
      }
    }
  };

  // Remove item from cart
  obj.removeItemFromCart = function (name) {
    for (var item in cart) {
      if (cart[item].name === name) {
        cart[item].count--;
        if (cart[item].count === 0) {
          cart.splice(item, 1);
        }
        break;
      }
    }
    saveCart();
  };

  // Remove all items from cart
  obj.removeItemFromCartAll = function (name) {
    for (var item in cart) {
      if (cart[item].name === name) {
        cart.splice(item, 1);
        break;
      }
    }
    saveCart();
  };

  // Clear cart
  obj.clearCart = function () {
    cart = [];
    saveCart();
  };

  // Count cart 
  obj.totalCount = function () {
    var totalCount = 0;
    for (var item in cart) {
      totalCount += cart[item].count;
    }
    return totalCount;
  };

  // Total cart
  obj.totalCart = function () {
    var totalCart = 0;
    for (var item in cart) {
      totalCart += cart[item].price * cart[item].count;
    }
    return Number(totalCart.toFixed(2));
  };

  // List cart
  obj.listCart = function () {
    var cartCopy = [];
    for (i in cart) {
      item = cart[i];
      itemCopy = {};
      for (p in item) {
        itemCopy[p] = item[p];

      }
      itemCopy.total = Number(item.price * item.count).toFixed(2);
      cartCopy.push(itemCopy);
    }
    return cartCopy;
  };

  // cart : Array
  // Item : Object/Class
  // addItemToCart : Function
  // removeItemFromCart : Function
  // removeItemFromCartAll : Function
  // clearCart : Function
  // countCart : Function
  // totalCart : Function
  // listCart : Function
  // saveCart : Function
  // loadCart : Function


  return obj;

}();


// *****************************************
// Triggers / Events
// *****************************************


// Add item
$('.add-to-cart').click(function (event) {
  event.preventDefault();
  var name = $(this).data('name');
  var price = Number($(this).data('price'));
  shoppingCart.addItemToCart(name, price, 1);
  displayCart();
});


// Clear items
$('.clear-cart').click(function () {
  shoppingCart.clearCart();
  displayCart();
  closeCart();
});




function displaySummary() {

  var cartArray = shoppingCart.listCart();
  var output = "";


  //// Table Headers ////
  output += "<thead><tr>" +
    "<th> Product </th>" +
    "<th> Price </th>" +
    "<th>  Quantity </th>" +
    "<th> Total </th>" +
    "</tr></thead>";


  output += "<tbody>";

  for (var i in cartArray) {
    output += "<tr>" +
    "<td>" + cartArray[i].name + "</td>" +
    "<td>" + cartArray[i].price + "</td>" +
    "<td>" + cartArray[i].count + "</td>" +
    "<td>" + cartArray[i].total + "</td>" +
    "</tr>";
  }

  output += "</tbody>";

  $('.summary-holder-show-cart').html(output);
  $('.summary-holder-total-cart').html(shoppingCart.totalCart());



  /// Address ///

  var address = get_address();

  var usersummary = "";

usersummary += "<thead><tr>" +
    "<th> Labels </th>" +
    "<th> User Details </th>" +
    "</tr></thead>";

usersummary += "<tbody>";

usersummary += "<tr>" +
    "<td> First Name: </td>"  +
    "<td>" + address.firstname + "</td>"  +
    "</tr>";

usersummary += "<tr>" +
    "<td> Last Name: </td>"  +
    "<td>" + address.lastname + "</td>"  +
    "</tr>";

usersummary += "<tr>" +
    "<td> Email: </td>"  +
    "<td>" + address.email + "</td>"  +
    "</tr>";

usersummary += "<tr>" +
    "<td> Phone: </td>"  +
    "<td>" + address.tel + "</td>"  +
    "</tr>";

  usersummary += "</tbody>";


  $('.summary-holder-user-details').html(usersummary);


  var output = "";

  //// Table Headers ////

  output += "<thead><tr>" +
    "<th> Billing Address  </th>" +
    "<th> Shipping Address </th>" +
    "</tr></thead>";


  output += "<tbody>";

  output += "<tr>" +
    "<td>" + address.billaddress + "</td>"  +
    "<td>" + address.shipaddress + "</td>"  +
    "</tr>";

  output += "<tr>" +
    "<td>" + address.billaddress2 + "</td>"  +
    "<td>" + address.shipaddress2 + "</td>"  +
    "</tr>";

  output += "<tr>" +
    "<td>" + address.billcity + " " +  address.billpostcode + "</td>"  +
    "<td>" + address.shipcity + " " +  address.shippostcode + "</td>"  +
    "</tr>";

  output += "<tr>" +
    "<td>" + address.billcountry + "</td>"  +
    "<td>" + address.shipcountry + "</td>"  +
    "</tr>";

  output += "</tbody>";


  $('.summary-holder-show-address').html(output);


}




function displayCart() {
  var cartArray = shoppingCart.listCart();
  var output = "";
  for (var i in cartArray) {
    output += "<tr>" +
    "<td>" + cartArray[i].name + "</td>" +
    "<td>(" + cartArray[i].price + ")</td>" +
    "<td><div class='input-group'><button class='minus-item input-group-addon btn btn-primary' data-name=" + cartArray[i].name + ">-</button>" +
    "<input type='number' class='item-count form-control' data-name='" + cartArray[i].name + "' value='" + cartArray[i].count + "'>" +
    "<button class='plus-item btn btn-primary input-group-addon' data-name=" + cartArray[i].name + ">+</button></div></td>" +
    "<td><button class='delete-item btn btn-danger' data-name=" + cartArray[i].name + ">X</button></td>" +
    " = " +
    "<td>" + cartArray[i].total + "</td>" +
    "</tr>";
  }
  $('.show-cart').html(output);
  $('.total-cart').html(shoppingCart.totalCart());
  $('.total-count').html(shoppingCart.totalCount());
}



// Delete item button
$('.show-cart').on("click", ".delete-item", function (event) {
  var name = $(this).data('name');
  shoppingCart.removeItemFromCartAll(name);
  displayCart();
});



// -1
$('.show-cart').on("click", ".minus-item", function (event) {
  var name = $(this).data('name');
  shoppingCart.removeItemFromCart(name);
  displayCart();
});



// +1
$('.show-cart').on("click", ".plus-item", function (event) {
  var name = $(this).data('name');
  shoppingCart.addItemToCart(name);
  displayCart();
});


// Item count input
$('.show-cart').on("change", ".item-count", function (event) {
  var name = $(this).data('name');
  var count = Number($(this).val());
  shoppingCart.setCountForItem(name, count);
  displayCart();
});


function displayAddressForm() {

  var form = "";

// onsubmit="event.preventDefault(); validateMyForm();"


form = `<form id="secure-form" class="needs-validation" onsubmit="event.preventDefault();">



<div class="form-row">
<div class="col-md-6 form-group">
<label for="firstname">First Name</label>



<input type="text" class="form-control" id="firstname" placeholder="First Name" required>
<div class="invalid-feedback">
Valid first name is required.
</div>
</div>
<div class="col-md-6 form-group">
<label for="lastname">Last Name</label>
<input type="text" class="form-control" id="lastname" placeholder="Last Name" required>
<div class="invalid-feedback">
Valid last name is required.
</div>
</div>
</div>



<div class="form-group">
<label for="email">Email</label>
<input type="email" class="form-control" id="email" placeholder="you@example.com" required>
</div>



<div class="form-group">
<label for="tel">Phone Number <span class="text-muted">Format: (+41-123456789) (Optional)</span></label>
<input type="tel" class="form-control" id="tel" pattern="[+]{0,1}[0-9]{0,3}-[0-9]{4,14}" placeholder="Your Phone Number">
</div>



<hr>
<br>

<label for="adress"><b>Billing Address: </b></label>
<br>
<br>

<div class="form-group">
<label for="address">Street Address</label>
<input type="text" class="form-control" id="billaddress" placeholder="1234 Main Street" required>
<div class="invalid-feedback">
Please enter your shipping address.
</div>
</div>


<div class="form-group">
<label for="address2">Street Address 2<span class="text-muted">(Optional)</span></label>
<input type="text" class="form-control" id="billaddress2" placeholder="Flat No">
</div>



<div class="form-row">

<div class="col-md-6 form-group">
<label for="city">City</label>
<input type="text" class="form-control" id="billcity" placeholder="City" required>
<div class="invalid-feedback">
Please provide a valid city.
</div>
</div>

<div class="col-md-6 form-group">
<label for="postcode">Postcode</label>
<input type="text" class="form-control" id="billpostcode" placeholder="Postcode" required>
<div class="invalid-feedback">
Postcode required.
</div>
</div>

</div>






<div class="row">

<div class="col-md-4 form-group">

<label for="country">Country</label>
<select type="text" class="form-control" id="billcountry" required>
<option value>Choose...</option>
<option value="Afganistan">Afghanistan</option>
   <option value="Albania">Albania</option>
   <option value="Algeria">Algeria</option>
   <option value="American Samoa">American Samoa</option>
   <option value="Andorra">Andorra</option>
   <option value="Angola">Angola</option>
   <option value="Anguilla">Anguilla</option>
   <option value="Antigua & Barbuda">Antigua & Barbuda</option>
   <option value="Argentina">Argentina</option>
   <option value="Armenia">Armenia</option>
   <option value="Aruba">Aruba</option>
   <option value="Australia">Australia</option>
   <option value="Austria">Austria</option>
   <option value="Azerbaijan">Azerbaijan</option>
   <option value="Bahamas">Bahamas</option>
   <option value="Bahrain">Bahrain</option>
   <option value="Bangladesh">Bangladesh</option>
   <option value="Barbados">Barbados</option>
   <option value="Belarus">Belarus</option>
   <option value="Belgium">Belgium</option>
   <option value="Belize">Belize</option>
   <option value="Benin">Benin</option>
   <option value="Bermuda">Bermuda</option>
   <option value="Bhutan">Bhutan</option>
   <option value="Bolivia">Bolivia</option>
   <option value="Bonaire">Bonaire</option>
   <option value="Bosnia & Herzegovina">Bosnia & Herzegovina</option>
   <option value="Botswana">Botswana</option>
   <option value="Brazil">Brazil</option>
   <option value="British Indian Ocean Ter">British Indian Ocean Ter</option>
   <option value="Brunei">Brunei</option>
   <option value="Bulgaria">Bulgaria</option>
   <option value="Burkina Faso">Burkina Faso</option>
   <option value="Burundi">Burundi</option>
   <option value="Cambodia">Cambodia</option>
   <option value="Cameroon">Cameroon</option>
   <option value="Canada">Canada</option>
   <option value="Canary Islands">Canary Islands</option>
   <option value="Cape Verde">Cape Verde</option>
   <option value="Cayman Islands">Cayman Islands</option>
   <option value="Central African Republic">Central African Republic</option>
   <option value="Chad">Chad</option>
   <option value="Channel Islands">Channel Islands</option>
   <option value="Chile">Chile</option>
   <option value="China">China</option>
   <option value="Christmas Island">Christmas Island</option>
   <option value="Cocos Island">Cocos Island</option>
   <option value="Colombia">Colombia</option>
   <option value="Comoros">Comoros</option>
   <option value="Congo">Congo</option>
   <option value="Cook Islands">Cook Islands</option>
   <option value="Costa Rica">Costa Rica</option>
   <option value="Cote DIvoire">Cote DIvoire</option>
   <option value="Croatia">Croatia</option>
   <option value="Cuba">Cuba</option>
   <option value="Curaco">Curacao</option>
   <option value="Cyprus">Cyprus</option>
   <option value="Czech Republic">Czech Republic</option>
   <option value="Denmark">Denmark</option>
   <option value="Djibouti">Djibouti</option>
   <option value="Dominica">Dominica</option>
   <option value="Dominican Republic">Dominican Republic</option>
   <option value="East Timor">East Timor</option>
   <option value="Ecuador">Ecuador</option>
   <option value="Egypt">Egypt</option>
   <option value="El Salvador">El Salvador</option>
   <option value="Equatorial Guinea">Equatorial Guinea</option>
   <option value="Eritrea">Eritrea</option>
   <option value="Estonia">Estonia</option>
   <option value="Ethiopia">Ethiopia</option>
   <option value="Falkland Islands">Falkland Islands</option>
   <option value="Faroe Islands">Faroe Islands</option>
   <option value="Fiji">Fiji</option>
   <option value="Finland">Finland</option>
   <option value="France">France</option>
   <option value="French Guiana">French Guiana</option>
   <option value="French Polynesia">French Polynesia</option>
   <option value="French Southern Ter">French Southern Ter</option>
   <option value="Gabon">Gabon</option>
   <option value="Gambia">Gambia</option>
   <option value="Georgia">Georgia</option>
   <option value="Germany">Germany</option>
   <option value="Ghana">Ghana</option>
   <option value="Gibraltar">Gibraltar</option>
   <option value="Great Britain">Great Britain</option>
   <option value="Greece">Greece</option>
   <option value="Greenland">Greenland</option>
   <option value="Grenada">Grenada</option>
   <option value="Guadeloupe">Guadeloupe</option>
   <option value="Guam">Guam</option>
   <option value="Guatemala">Guatemala</option>
   <option value="Guinea">Guinea</option>
   <option value="Guyana">Guyana</option>
   <option value="Haiti">Haiti</option>
   <option value="Hawaii">Hawaii</option>
   <option value="Honduras">Honduras</option>
   <option value="Hong Kong">Hong Kong</option>
   <option value="Hungary">Hungary</option>
   <option value="Iceland">Iceland</option>
   <option value="Indonesia">Indonesia</option>
   <option value="India">India</option>
   <option value="Iran">Iran</option>
   <option value="Iraq">Iraq</option>
   <option value="Ireland">Ireland</option>
   <option value="Isle of Man">Isle of Man</option>
   <option value="Israel">Israel</option>
   <option value="Italy">Italy</option>
   <option value="Jamaica">Jamaica</option>
   <option value="Japan">Japan</option>
   <option value="Jordan">Jordan</option>
   <option value="Kazakhstan">Kazakhstan</option>
   <option value="Kenya">Kenya</option>
   <option value="Kiribati">Kiribati</option>
   <option value="Korea North">Korea North</option>
   <option value="Korea Sout">Korea South</option>
   <option value="Kuwait">Kuwait</option>
   <option value="Kyrgyzstan">Kyrgyzstan</option>
   <option value="Laos">Laos</option>
   <option value="Latvia">Latvia</option>
   <option value="Lebanon">Lebanon</option>
   <option value="Lesotho">Lesotho</option>
   <option value="Liberia">Liberia</option>
   <option value="Libya">Libya</option>
   <option value="Liechtenstein">Liechtenstein</option>
   <option value="Lithuania">Lithuania</option>
   <option value="Luxembourg">Luxembourg</option>
   <option value="Macau">Macau</option>
   <option value="Macedonia">Macedonia</option>
   <option value="Madagascar">Madagascar</option>
   <option value="Malaysia">Malaysia</option>
   <option value="Malawi">Malawi</option>
   <option value="Maldives">Maldives</option>
   <option value="Mali">Mali</option>
   <option value="Malta">Malta</option>
   <option value="Marshall Islands">Marshall Islands</option>
   <option value="Martinique">Martinique</option>
   <option value="Mauritania">Mauritania</option>
   <option value="Mauritius">Mauritius</option>
   <option value="Mayotte">Mayotte</option>
   <option value="Mexico">Mexico</option>
   <option value="Midway Islands">Midway Islands</option>
   <option value="Moldova">Moldova</option>
   <option value="Monaco">Monaco</option>
   <option value="Mongolia">Mongolia</option>
   <option value="Montserrat">Montserrat</option>
   <option value="Morocco">Morocco</option>
   <option value="Mozambique">Mozambique</option>
   <option value="Myanmar">Myanmar</option>
   <option value="Nambia">Nambia</option>
   <option value="Nauru">Nauru</option>
   <option value="Nepal">Nepal</option>
   <option value="Netherland Antilles">Netherland Antilles</option>
   <option value="Netherlands">Netherlands (Holland, Europe)</option>
   <option value="Nevis">Nevis</option>
   <option value="New Caledonia">New Caledonia</option>
   <option value="New Zealand">New Zealand</option>
   <option value="Nicaragua">Nicaragua</option>
   <option value="Niger">Niger</option>
   <option value="Nigeria">Nigeria</option>
   <option value="Niue">Niue</option>
   <option value="Norfolk Island">Norfolk Island</option>
   <option value="Norway">Norway</option>
   <option value="Oman">Oman</option>
   <option value="Pakistan">Pakistan</option>
   <option value="Palau Island">Palau Island</option>
   <option value="Palestine">Palestine</option>
   <option value="Panama">Panama</option>
   <option value="Papua New Guinea">Papua New Guinea</option>
   <option value="Paraguay">Paraguay</option>
   <option value="Peru">Peru</option>
   <option value="Phillipines">Philippines</option>
   <option value="Pitcairn Island">Pitcairn Island</option>
   <option value="Poland">Poland</option>
   <option value="Portugal">Portugal</option>
   <option value="Puerto Rico">Puerto Rico</option>
   <option value="Qatar">Qatar</option>
   <option value="Republic of Montenegro">Republic of Montenegro</option>
   <option value="Republic of Serbia">Republic of Serbia</option>
   <option value="Reunion">Reunion</option>
   <option value="Romania">Romania</option>
   <option value="Russia">Russia</option>
   <option value="Rwanda">Rwanda</option>
   <option value="St Barthelemy">St Barthelemy</option>
   <option value="St Eustatius">St Eustatius</option>
   <option value="St Helena">St Helena</option>
   <option value="St Kitts-Nevis">St Kitts-Nevis</option>
   <option value="St Lucia">St Lucia</option>
   <option value="St Maarten">St Maarten</option>
   <option value="St Pierre & Miquelon">St Pierre & Miquelon</option>
   <option value="St Vincent & Grenadines">St Vincent & Grenadines</option>
   <option value="Saipan">Saipan</option>
   <option value="Samoa">Samoa</option>
   <option value="Samoa American">Samoa American</option>
   <option value="San Marino">San Marino</option>
   <option value="Sao Tome & Principe">Sao Tome & Principe</option>
   <option value="Saudi Arabia">Saudi Arabia</option>
   <option value="Senegal">Senegal</option>
   <option value="Seychelles">Seychelles</option>
   <option value="Sierra Leone">Sierra Leone</option>
   <option value="Singapore">Singapore</option>
   <option value="Slovakia">Slovakia</option>
   <option value="Slovenia">Slovenia</option>
   <option value="Solomon Islands">Solomon Islands</option>
   <option value="Somalia">Somalia</option>
   <option value="South Africa">South Africa</option>
   <option value="Spain">Spain</option>
   <option value="Sri Lanka">Sri Lanka</option>
   <option value="Sudan">Sudan</option>
   <option value="Suriname">Suriname</option>
   <option value="Swaziland">Swaziland</option>
   <option value="Sweden">Sweden</option>
   <option value="Switzerland">Switzerland</option>
   <option value="Syria">Syria</option>
   <option value="Tahiti">Tahiti</option>
   <option value="Taiwan">Taiwan</option>
   <option value="Tajikistan">Tajikistan</option>
   <option value="Tanzania">Tanzania</option>
   <option value="Thailand">Thailand</option>
   <option value="Togo">Togo</option>
   <option value="Tokelau">Tokelau</option>
   <option value="Tonga">Tonga</option>
   <option value="Trinidad & Tobago">Trinidad & Tobago</option>
   <option value="Tunisia">Tunisia</option>
   <option value="Turkey">Turkey</option>
   <option value="Turkmenistan">Turkmenistan</option>
   <option value="Turks & Caicos Is">Turks & Caicos Is</option>
   <option value="Tuvalu">Tuvalu</option>
   <option value="Uganda">Uganda</option>
   <option value="United Kingdom">United Kingdom</option>
   <option value="Ukraine">Ukraine</option>
   <option value="United Arab Erimates">United Arab Emirates</option>
   <option value="United States of America">United States of America</option>
   <option value="Uraguay">Uruguay</option>
   <option value="Uzbekistan">Uzbekistan</option>
   <option value="Vanuatu">Vanuatu</option>
   <option value="Vatican City State">Vatican City State</option>
   <option value="Venezuela">Venezuela</option>
   <option value="Vietnam">Vietnam</option>
   <option value="Virgin Islands (Brit)">Virgin Islands (Brit)</option>
   <option value="Virgin Islands (USA)">Virgin Islands (USA)</option>
   <option value="Wake Island">Wake Island</option>
   <option value="Wallis & Futana Is">Wallis & Futana Is</option>
   <option value="Yemen">Yemen</option>
   <option value="Zaire">Zaire</option>
   <option value="Zambia">Zambia</option>
   <option value="Zimbabwe">Zimbabwe</option>
</select>

<div class="invalid-feedback">
Please select a valid country.
</div>

</div>

</div>



<hr>






<div class="form-check">
<input type="checkbox" class="form-check-input" id="shipaddress-checkbox" onclick="checkedStatus()" checked>
<label for="shipping-adress" class="form-check-label">Shipping address is the same as my billing address</label>
</div>

<hr>
<br>





 
<div id="shipaddress-group" class="shipaddress-group">
<label for="adress"><b>Shipping Address: </b></label>
<span class="text-muted">(Optional)</span>
<br>
<br>

<div class="form-group">
<label for="address">Street Address</label>
<input type="text" class="form-control" id="shipaddress" placeholder="1234 Main Street" >
<div class="invalid-feedback">
Please enter your billing address.
</div>
</div>


<div class="form-group">
<label for="address2">Street Address 2 <span class="text-muted">(Optional)</span></label>
<input type="text" class="form-control" id="shipaddress2" placeholder="Flat No">
</div>






<div class="form-row">

<div class="col-md-6 form-group">
<label for="city">City</label>
<input type="text" class="form-control" id="shipcity" placeholder="City">
<div class="invalid-feedback">
Please provide a valid city.
</div>
</div>

<div class="col-md-6 form-group">
<label for="postcode">Postcode</label>
<input type="text" class="form-control" id="shippostcode" placeholder="Postcode">
<div class="invalid-feedback">
Postcode required.
</div>
</div>

</div>






<div class="row">
<div class="col-md-4 form-group">

<label for="country">Country</label>
<select type="text" class="form-control" id="shipcountry">
<option value>Choose...</option>
<option value="Afganistan">Afghanistan</option>
   <option value="Albania">Albania</option>
   <option value="Algeria">Algeria</option>
   <option value="American Samoa">American Samoa</option>
   <option value="Andorra">Andorra</option>
   <option value="Angola">Angola</option>
   <option value="Anguilla">Anguilla</option>
   <option value="Antigua & Barbuda">Antigua & Barbuda</option>
   <option value="Argentina">Argentina</option>
   <option value="Armenia">Armenia</option>
   <option value="Aruba">Aruba</option>
   <option value="Australia">Australia</option>
   <option value="Austria">Austria</option>
   <option value="Azerbaijan">Azerbaijan</option>
   <option value="Bahamas">Bahamas</option>
   <option value="Bahrain">Bahrain</option>
   <option value="Bangladesh">Bangladesh</option>
   <option value="Barbados">Barbados</option>
   <option value="Belarus">Belarus</option>
   <option value="Belgium">Belgium</option>
   <option value="Belize">Belize</option>
   <option value="Benin">Benin</option>
   <option value="Bermuda">Bermuda</option>
   <option value="Bhutan">Bhutan</option>
   <option value="Bolivia">Bolivia</option>
   <option value="Bonaire">Bonaire</option>
   <option value="Bosnia & Herzegovina">Bosnia & Herzegovina</option>
   <option value="Botswana">Botswana</option>
   <option value="Brazil">Brazil</option>
   <option value="British Indian Ocean Ter">British Indian Ocean Ter</option>
   <option value="Brunei">Brunei</option>
   <option value="Bulgaria">Bulgaria</option>
   <option value="Burkina Faso">Burkina Faso</option>
   <option value="Burundi">Burundi</option>
   <option value="Cambodia">Cambodia</option>
   <option value="Cameroon">Cameroon</option>
   <option value="Canada">Canada</option>
   <option value="Canary Islands">Canary Islands</option>
   <option value="Cape Verde">Cape Verde</option>
   <option value="Cayman Islands">Cayman Islands</option>
   <option value="Central African Republic">Central African Republic</option>
   <option value="Chad">Chad</option>
   <option value="Channel Islands">Channel Islands</option>
   <option value="Chile">Chile</option>
   <option value="China">China</option>
   <option value="Christmas Island">Christmas Island</option>
   <option value="Cocos Island">Cocos Island</option>
   <option value="Colombia">Colombia</option>
   <option value="Comoros">Comoros</option>
   <option value="Congo">Congo</option>
   <option value="Cook Islands">Cook Islands</option>
   <option value="Costa Rica">Costa Rica</option>
   <option value="Cote DIvoire">Cote DIvoire</option>
   <option value="Croatia">Croatia</option>
   <option value="Cuba">Cuba</option>
   <option value="Curaco">Curacao</option>
   <option value="Cyprus">Cyprus</option>
   <option value="Czech Republic">Czech Republic</option>
   <option value="Denmark">Denmark</option>
   <option value="Djibouti">Djibouti</option>
   <option value="Dominica">Dominica</option>
   <option value="Dominican Republic">Dominican Republic</option>
   <option value="East Timor">East Timor</option>
   <option value="Ecuador">Ecuador</option>
   <option value="Egypt">Egypt</option>
   <option value="El Salvador">El Salvador</option>
   <option value="Equatorial Guinea">Equatorial Guinea</option>
   <option value="Eritrea">Eritrea</option>
   <option value="Estonia">Estonia</option>
   <option value="Ethiopia">Ethiopia</option>
   <option value="Falkland Islands">Falkland Islands</option>
   <option value="Faroe Islands">Faroe Islands</option>
   <option value="Fiji">Fiji</option>
   <option value="Finland">Finland</option>
   <option value="France">France</option>
   <option value="French Guiana">French Guiana</option>
   <option value="French Polynesia">French Polynesia</option>
   <option value="French Southern Ter">French Southern Ter</option>
   <option value="Gabon">Gabon</option>
   <option value="Gambia">Gambia</option>
   <option value="Georgia">Georgia</option>
   <option value="Germany">Germany</option>
   <option value="Ghana">Ghana</option>
   <option value="Gibraltar">Gibraltar</option>
   <option value="Great Britain">Great Britain</option>
   <option value="Greece">Greece</option>
   <option value="Greenland">Greenland</option>
   <option value="Grenada">Grenada</option>
   <option value="Guadeloupe">Guadeloupe</option>
   <option value="Guam">Guam</option>
   <option value="Guatemala">Guatemala</option>
   <option value="Guinea">Guinea</option>
   <option value="Guyana">Guyana</option>
   <option value="Haiti">Haiti</option>
   <option value="Hawaii">Hawaii</option>
   <option value="Honduras">Honduras</option>
   <option value="Hong Kong">Hong Kong</option>
   <option value="Hungary">Hungary</option>
   <option value="Iceland">Iceland</option>
   <option value="Indonesia">Indonesia</option>
   <option value="India">India</option>
   <option value="Iran">Iran</option>
   <option value="Iraq">Iraq</option>
   <option value="Ireland">Ireland</option>
   <option value="Isle of Man">Isle of Man</option>
   <option value="Israel">Israel</option>
   <option value="Italy">Italy</option>
   <option value="Jamaica">Jamaica</option>
   <option value="Japan">Japan</option>
   <option value="Jordan">Jordan</option>
   <option value="Kazakhstan">Kazakhstan</option>
   <option value="Kenya">Kenya</option>
   <option value="Kiribati">Kiribati</option>
   <option value="Korea North">Korea North</option>
   <option value="Korea Sout">Korea South</option>
   <option value="Kuwait">Kuwait</option>
   <option value="Kyrgyzstan">Kyrgyzstan</option>
   <option value="Laos">Laos</option>
   <option value="Latvia">Latvia</option>
   <option value="Lebanon">Lebanon</option>
   <option value="Lesotho">Lesotho</option>
   <option value="Liberia">Liberia</option>
   <option value="Libya">Libya</option>
   <option value="Liechtenstein">Liechtenstein</option>
   <option value="Lithuania">Lithuania</option>
   <option value="Luxembourg">Luxembourg</option>
   <option value="Macau">Macau</option>
   <option value="Macedonia">Macedonia</option>
   <option value="Madagascar">Madagascar</option>
   <option value="Malaysia">Malaysia</option>
   <option value="Malawi">Malawi</option>
   <option value="Maldives">Maldives</option>
   <option value="Mali">Mali</option>
   <option value="Malta">Malta</option>
   <option value="Marshall Islands">Marshall Islands</option>
   <option value="Martinique">Martinique</option>
   <option value="Mauritania">Mauritania</option>
   <option value="Mauritius">Mauritius</option>
   <option value="Mayotte">Mayotte</option>
   <option value="Mexico">Mexico</option>
   <option value="Midway Islands">Midway Islands</option>
   <option value="Moldova">Moldova</option>
   <option value="Monaco">Monaco</option>
   <option value="Mongolia">Mongolia</option>
   <option value="Montserrat">Montserrat</option>
   <option value="Morocco">Morocco</option>
   <option value="Mozambique">Mozambique</option>
   <option value="Myanmar">Myanmar</option>
   <option value="Nambia">Nambia</option>
   <option value="Nauru">Nauru</option>
   <option value="Nepal">Nepal</option>
   <option value="Netherland Antilles">Netherland Antilles</option>
   <option value="Netherlands">Netherlands (Holland, Europe)</option>
   <option value="Nevis">Nevis</option>
   <option value="New Caledonia">New Caledonia</option>
   <option value="New Zealand">New Zealand</option>
   <option value="Nicaragua">Nicaragua</option>
   <option value="Niger">Niger</option>
   <option value="Nigeria">Nigeria</option>
   <option value="Niue">Niue</option>
   <option value="Norfolk Island">Norfolk Island</option>
   <option value="Norway">Norway</option>
   <option value="Oman">Oman</option>
   <option value="Pakistan">Pakistan</option>
   <option value="Palau Island">Palau Island</option>
   <option value="Palestine">Palestine</option>
   <option value="Panama">Panama</option>
   <option value="Papua New Guinea">Papua New Guinea</option>
   <option value="Paraguay">Paraguay</option>
   <option value="Peru">Peru</option>
   <option value="Phillipines">Philippines</option>
   <option value="Pitcairn Island">Pitcairn Island</option>
   <option value="Poland">Poland</option>
   <option value="Portugal">Portugal</option>
   <option value="Puerto Rico">Puerto Rico</option>
   <option value="Qatar">Qatar</option>
   <option value="Republic of Montenegro">Republic of Montenegro</option>
   <option value="Republic of Serbia">Republic of Serbia</option>
   <option value="Reunion">Reunion</option>
   <option value="Romania">Romania</option>
   <option value="Russia">Russia</option>
   <option value="Rwanda">Rwanda</option>
   <option value="St Barthelemy">St Barthelemy</option>
   <option value="St Eustatius">St Eustatius</option>
   <option value="St Helena">St Helena</option>
   <option value="St Kitts-Nevis">St Kitts-Nevis</option>
   <option value="St Lucia">St Lucia</option>
   <option value="St Maarten">St Maarten</option>
   <option value="St Pierre & Miquelon">St Pierre & Miquelon</option>
   <option value="St Vincent & Grenadines">St Vincent & Grenadines</option>
   <option value="Saipan">Saipan</option>
   <option value="Samoa">Samoa</option>
   <option value="Samoa American">Samoa American</option>
   <option value="San Marino">San Marino</option>
   <option value="Sao Tome & Principe">Sao Tome & Principe</option>
   <option value="Saudi Arabia">Saudi Arabia</option>
   <option value="Senegal">Senegal</option>
   <option value="Seychelles">Seychelles</option>
   <option value="Sierra Leone">Sierra Leone</option>
   <option value="Singapore">Singapore</option>
   <option value="Slovakia">Slovakia</option>
   <option value="Slovenia">Slovenia</option>
   <option value="Solomon Islands">Solomon Islands</option>
   <option value="Somalia">Somalia</option>
   <option value="South Africa">South Africa</option>
   <option value="Spain">Spain</option>
   <option value="Sri Lanka">Sri Lanka</option>
   <option value="Sudan">Sudan</option>
   <option value="Suriname">Suriname</option>
   <option value="Swaziland">Swaziland</option>
   <option value="Sweden">Sweden</option>
   <option value="Switzerland">Switzerland</option>
   <option value="Syria">Syria</option>
   <option value="Tahiti">Tahiti</option>
   <option value="Taiwan">Taiwan</option>
   <option value="Tajikistan">Tajikistan</option>
   <option value="Tanzania">Tanzania</option>
   <option value="Thailand">Thailand</option>
   <option value="Togo">Togo</option>
   <option value="Tokelau">Tokelau</option>
   <option value="Tonga">Tonga</option>
   <option value="Trinidad & Tobago">Trinidad & Tobago</option>
   <option value="Tunisia">Tunisia</option>
   <option value="Turkey">Turkey</option>
   <option value="Turkmenistan">Turkmenistan</option>
   <option value="Turks & Caicos Is">Turks & Caicos Is</option>
   <option value="Tuvalu">Tuvalu</option>
   <option value="Uganda">Uganda</option>
   <option value="United Kingdom">United Kingdom</option>
   <option value="Ukraine">Ukraine</option>
   <option value="United Arab Erimates">United Arab Emirates</option>
   <option value="United States of America">United States of America</option>
   <option value="Uraguay">Uruguay</option>
   <option value="Uzbekistan">Uzbekistan</option>
   <option value="Vanuatu">Vanuatu</option>
   <option value="Vatican City State">Vatican City State</option>
   <option value="Venezuela">Venezuela</option>
   <option value="Vietnam">Vietnam</option>
   <option value="Virgin Islands (Brit)">Virgin Islands (Brit)</option>
   <option value="Virgin Islands (USA)">Virgin Islands (USA)</option>
   <option value="Wake Island">Wake Island</option>
   <option value="Wallis & Futana Is">Wallis & Futana Is</option>
   <option value="Yemen">Yemen</option>
   <option value="Zaire">Zaire</option>
   <option value="Zambia">Zambia</option>
   <option value="Zimbabwe">Zimbabwe</option>
</select>

<div class="invalid-feedback">
Please select a valid country.
</div>

</div>
</div>



<br>

<hr>

</div>



<br>



<div class="row">

<div class="col-md-6 form-group ">
<button type="button" class="btn btn-secondary vPrevious float-left"  onclick="vPrevious()" >Back</button>

</div>

<div class="col-md-6 form-group ">
<button class="btn btn-primary float-right" type="submit" onclick="validateForm()">Next</button> 
</div>

</div>







</form>
`
  
$('.form-holder').html(form);

}



function validateForm() {

  console.log("validateForm clicked...");

  var x = document.getElementById("secure-form");

  if (x.checkValidity() === true)
  {
    save_address();
    hideAllForms();
    //$('.payment-holder').show();
    //$('.vPrevious').show();
    //displayPayment();

    state += 1;
    checkRelevance();
  }

}


function displayPayment(){

  var form = "";

  form = `

<!-- Display a payment form -->

<form id="payment-form" class="stripe-form">

<div id="card-element"></div>
<br>

<button id="payment-form-submit" class="stripe-button">
    <div class="stripe-spinner stripe-hidden" id="payment-form-spinner"></div>
    <span id="payment-form-button-text">Pay Now</span>
</button>

<p id="payment-form-card-error" role="alert"></p>

<br>


</form> `


  
  $('.payment-holder').html(form);

  LoadPayment();

}



function get_address(){
  var address = [];

  var content = sessionStorage.getItem('address');
  console.log(content);

  if(content){
    address = JSON.parse(content)[0];
  }
  return address;
}



function load_address(){

  var address = get_address();

  console.log("Loading_address...", address);
  
  var x = document.getElementById("secure-form");

  cc = document.getElementById("billcountry");

  cs = document.getElementById("shipcountry");
  
  
  for (i = 0; i < x.length; i++) {
    
    if (x[i].tagName == "INPUT"){
      
      if (address[x[i].id] === 'undefined' || address[x[i].id] === "" || address[x[i].id] === undefined)
      {
        //console.log( "Undefined: ", address[x[i].id] );
      }
      else
      {
        //console.log( "Defined: ", address[x[i].id] );
        x[i].value = address[x[i].id];
        cc.value = address["billcountry"];
        cs.value = address["shipcountry"];
      }

    }

  }

  console.log("Load address:", address);

}



function save_address(){

  //console.log("Saving_address...");

  var address = [];

  var x = document.getElementById("secure-form");


  var ch = document.getElementById("shipaddress-checkbox");


  if (ch.checked) {
     document.getElementById("shipaddress").value = document.getElementById("billaddress").value;
     document.getElementById("shipaddress2").value = document.getElementById("billaddress2").value;
     document.getElementById("shipcity").value = document.getElementById("billcity").value;
     document.getElementById("shippostcode").value = document.getElementById("billpostcode").value; 
     document.getElementById("shipcountry").value = document.getElementById("billcountry").value;     
  }


  var key = {};

  for (i = 0; i < x.length; i++) {
    
    if (x[i].tagName == "INPUT"){

      //var obj = {};
      //obj[x[i].id] = x[i].value;
      //address.push(obj);

      key[x[i].id] = x[i].value;

    }

  }


  // Add Country
  cc = document.getElementById("billcountry");
  key["billcountry"] = cc.value;

  cs = document.getElementById("shipcountry");

  //var key = {};
  key["shipcountry"] = cs.value;
  

  address.push(key);
  
  
  //console.log("Obj key: ", key);
  console.log("Save address:", address);
  
  sessionStorage.setItem('address', JSON.stringify(address));
  

}


function stripeAddress( customer )
{
  
  var addr = [];

  //var addr = get_address();
  //var key = {};
  //key["shipcountry"] = cs.value;
  //address.push(key);
  //console.log("Obj key: ", key);
  //console.log("Save address:", address);

  
  var address = {};

  address.firstname = customer.name.split(" ")[0];
  address.lastname = customer.name.split(" ")[1];
  address.email = customer.email;
  address.tel = customer.phone;
  address.billaddress = customer.address.line1;
  address.billaddress2 = customer.address.line2;
  address.billcity = customer.address.city;
  address.billpostcode = customer.address.postal_code;
  address.billcountry = customer.address.country;

  address.shipaddress = customer.shipping.address.line1;
  address.shipaddress2 = customer.shipping.address.line2;
  address.shipcity = customer.shipping.address.city;
  address.shippostcode = customer.shipping.address.postal_code;
  address.shipcountry = customer.shipping.address.country;


  addr.push(address);

  sessionStorage.setItem( 'address' , JSON.stringify(addr) );


}




function hideAllForms(){
  $('.payment-holder').hide();
  $(".vCart").hide();
  $('.form-holder').hide();
  $('.vPrevious').hide();
  $('.next-address').hide();
  $(".signin-holder").hide();
  $(".summary-holder").hide();
}



/// shipaddress-checkbox ///

function checkedStatus()
{

  if( $('#shipaddress-checkbox').is(":checked") === true)
  {
    document.querySelector("#shipaddress-group").classList.add("stripe-hidden");
  }
  else{
    // shipaddress-group
    document.querySelector("#shipaddress-group").classList.remove("stripe-hidden");
  }

}


function checkRelevance(){

  if (state === 0){
    hideAllForms();
    $(".vCart").show();
    $('.next-address').show();
    displayCart();
  }

  if (state === 1){

    /// Login FORM ///

    hideAllForms();
    $(".signin-holder").show();
    $('.vPrevious').show();

  }

  if (state === 2){
    hideAllForms();
    $('.form-holder').show();
    //$('.vPrevious').show();
    //$('.next-address').show();
    displayAddressForm();
    load_address();
    checkedStatus();
  }

  if (state === 3){
    hideAllForms();
    $(".summary-holder").show();
    $('.vPrevious').show();
    $('.next-address').show();
    displaySummary();

    if(createCustomer)
    {

      /// Create Stripe Customer With address and Add it to FaunnaDB

      console.log("creating new Customer in Stripe");
      
      createCustomerStripe();
      
    }
    else
    {

       /// Update existing Customer ///
       updateCustomerStripe();

    }

  }

  // Payment Gateway //
  if (state === 4){

    save_address();
    hideAllForms();
    $('.payment-holder').show();
    $('.vPrevious').show();
    displayPayment();

  }

  // document.getElementById("secure-form").submit();
  // https://stripe.com/docs/payments#online
  // https://stripe.com/docs/payments/integration-builder
  

  console.log("state: ", state);

}



var state = 0;
// This Runs when Page is Loaded.
$( document ).ready(function() {
  //console.log( "Page Reloaded...\nLoading Data..." );
  state = 0;
  checkRelevance();
});



$('.next-address').click(function (event) {
  event.preventDefault();

  /// Skip State 1 when user is loggedin
  if (isUserloggedIn() && state === 0){
    state += 2;
  }
  else
  {
    state += 1;
  }
  
  checkRelevance();

});


function vGuestLogin () {
  event.preventDefault();
  state += 1;
  checkRelevance();
}


function vPreviousState() {
  state -= 1;
  checkRelevance();
}

function vNextState() {
  state += 1;
  checkRelevance();
}


function vPrevious(){
  event.preventDefault();
  /// Skip State 1 when user is loggedin
  if (isUserloggedIn() && state === 2){
    state -= 2;
  }
  else
  {
    state -= 1;
  }

  checkRelevance();

}



$('.vPrevious').click(function (event) {
  event.preventDefault();
  state -= 1;
  checkRelevance();
});



$('.grynn-order-now').click(function (event) {

  event.preventDefault();

  var cartArray = shoppingCart.listCart();

  cartArray.push("")

  //console.log(cartArray);

  //alert(shoppingCart.totalCart());


  var datavv = JSON.stringify(cartArray);

  $.ajax({
    type: 'POST',
    url: 'https://priceless-sammet-5f9486.netlify.app/.netlify/functions/shop',
    crossDomain: true,
    data: datavv,
    dataType: 'json',
    success: function(responseData, textStatus, jqXHR) {
        //var value = responseData.name;
        alert(responseData);
        //alert(value);
    },
    error: function (responseData, textStatus, errorThrown) {
        alert(errorThrown);
    }
  });


});




function closeCart(){
  // Reset Cart
  state = 0;
  checkRelevance();

  // Clear Cart items
  shoppingCart.clearCart();
  displayCart();

  // Hide Cart Modal View
  $('#cart').modal('hide');
  
}


function isUserloggedIn(){
  return user_id.length > 1;
}


function LoadPayment(){

// Strip Client JS

// Stripe Publishable API key.
var stripe = Stripe("pk_test_51HAbz2AQ0qxfxSJ1BFA6VdksLhae4TOWuqTgb3jgZD2Ep9Zu9xGvP3hn8u5LKjDM6fVKG8Xh8dnHoNkzshrVto2L00F63wjGpz");


var cartArray = shoppingCart.listCart();

//console.log("Loading Cart: ", cartArray);

var purchase = JSON.stringify(cartArray);

console.log("Loading datavv: ", purchase);

var address = get_address();

//console.log("Loading_address_form...", address, address.email);

var data = []

data.push(address);

data.push(cartArray);

data.push({ "customerID" : user_stripe_id });

//console.log("Loading_address...", JSON.stringify(data) );
//console.log("Loading_address...", data[0]);
//console.log("Loading_address...", data[1]);

console.log("data...", data);
var resData = JSON.stringify(data);

console.log("resData...", resData);



// Disable the button until we have Stripe set up on the page
document.querySelector(".stripe-button").disabled = true;



if (isUserloggedIn())
{

  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/createpaymentintent", {

  method: "POST",

  headers: {
    "Content-Type": "application/json"
  },

  body: JSON.stringify(resData)

  })
  .then(function(result) {
    //console.log(result.json());
    return result.json();
  })
  .then(function(data) {

    console.log(data);    

    var elements = stripe.elements();

    var style = {
      base: {
        color: "#32325d",
        fontFamily: 'Arial, sans-serif',
        fontSmoothing: "antialiased",
        fontSize: "16px",
        "::placeholder": {
          color: "#32325d"
        }
      },
      invalid: {
        fontFamily: 'Arial, sans-serif',
        color: "#fa755a",
        iconColor: "#fa755a"
      }
    };

    var card = elements.create("card", { style: style });
    // Stripe injects an iframe into the DOM
    card.mount("#card-element");

    card.on("change", function (event) {
      // Disable the Pay button if there are no card details in the Element
      document.querySelector(".stripe-button").disabled = event.empty; 
      document.querySelector("#payment-form-card-error").textContent = event.error ? event.error.message : "";
    });

    var form = document.getElementById("payment-form");
    form.addEventListener("submit", function(event) {
      event.preventDefault();
      // Complete payment when the submit button is clicked
      payWithCard(stripe, card, data.clientSecret);
    });
  });
  



}
else
{


  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/server", {

  method: "POST",

  headers: {
    "Content-Type": "application/json"
  },

  body: JSON.stringify(resData)

  })
  .then(function(result) {
    //console.log(result.json());
    return result.json();
  })
  .then(function(data) {

    console.log(data);    

    var elements = stripe.elements();

    var style = {
      base: {
        color: "#32325d",
        fontFamily: 'Arial, sans-serif',
        fontSmoothing: "antialiased",
        fontSize: "16px",
        "::placeholder": {
          color: "#32325d"
        }
      },
      invalid: {
        fontFamily: 'Arial, sans-serif',
        color: "#fa755a",
        iconColor: "#fa755a"
      }
    };

    var card = elements.create("card", { style: style });
    // Stripe injects an iframe into the DOM
    card.mount("#card-element");

    card.on("change", function (event) {
      // Disable the Pay button if there are no card details in the Element
      document.querySelector(".stripe-button").disabled = event.empty; 
      document.querySelector("#payment-form-card-error").textContent = event.error ? event.error.message : "";
    });

    var form = document.getElementById("payment-form");
    form.addEventListener("submit", function(event) {
      event.preventDefault();
      // Complete payment when the submit button is clicked
      payWithCard(stripe, card, data.clientSecret);
    });
  });

}


// Calls stripe.confirmCardPayment
// If the card requires authentication Stripe shows a pop-up modal to
// prompt the user to enter authentication details without leaving your page.
var payWithCard = function(stripe, card, clientSecret) {
  loading(true);
  stripe
    .confirmCardPayment(clientSecret, {
      receipt_email: address.email,
      payment_method: {
        card: card
      }
    })
    .then(function(result) {
      if (result.error) {
        // Show error to your customer
        console.log("Error Message...", result);
        DisplayPaymentResult( result.error.message, true);
      } else {
        // The payment succeeded!
        console.log("The payment succeeded! \n", result);
        closeCart();
        DisplayPaymentResult( result.paymentIntent.id, false);
        //orderComplete(result.paymentIntent.id, false);
      }
    });
};




function DisplayPaymentResult( message, error )
{

var res = "<p>";

if (error){
  res += "Payment was unsuccessful.";
}
else
{
  linkv = "https://dashboard.stripe.com/test/payments/" + message;
  res += 'Payment completed successfully.<br><br>Payment Id: &nbsp; &nbsp; <a href="' + linkv + '">' + message + '</a>';
}

res += "<p>";
  
$('.stripe-result-modal-body').html(res);

$("#stripe-result-modal").modal({show: true});

}



/* ------- UI helpers ------- */

// Show a spinner on payment submission
var loading = function(isLoading) {
  if (isLoading) {
    // Disable the button and show a spinner
    document.querySelector(".stripe-button").disabled = true;
    document.querySelector("#payment-form-spinner").classList.remove("stripe-hidden");
    document.querySelector("#payment-form-button-text").classList.add("stripe-hidden");
  } else {
    // Enable the button and Hide the spinner
    document.querySelector(".stripe-button").disabled = false;
    document.querySelector("#payment-form-spinner").classList.add("stripe-hidden");
    document.querySelector("#payment-form-button-text").classList.remove("stripe-hidden");
  }
};

}



function alterMenu() {

  document.querySelector(".netlify-identity-menu").classList.add("navbar-nav");

  document.querySelector(".netlify-identity-menu").classList.add("ml-auto");

  document.querySelectorAll(".netlify-identity-item").forEach( function(item, index){
    item.classList.add("nav-item");
  });

  document.querySelector(".netlify-identity-login").classList.add("nav-link");

  document.querySelector(".netlify-identity-signup").classList.add("nav-link");

  //var login = document.getElementById('login');

  //console.log(login);
}



function alertFunction() {

  setTimeout(

    function() {

      document.querySelector(".netlify-identity-menu").classList.add("navbar-nav");

      document.querySelector(".netlify-identity-menu").classList.add("ml-auto");

      document.querySelectorAll(".netlify-identity-item").forEach( function(item, index){
          item.classList.add("nav-item");
      });

      document.querySelector(".netlify-identity-login").classList.add("nav-link");

      document.querySelector(".netlify-identity-signup").classList.add("nav-link");

      var login = document.getElementById('login');

      console.log(login);

  }, 1);
}



window.onload = alterMenu;



var user_id = "";
var user_email = "";
var user_stripe_id = "";
var user_full_name = "";
var createCustomer = false;
var payasguest = true;
var userloggedin = false;


function loginNetlifyIdentity(user) {

  userloggedin = true;

  netlifyIdentity.refresh().then((jwt)=>console.log(jwt));

  const vv = netlifyIdentity.currentUser();

  var userEmail = vv.email;
  
  console.log(user);

  user_id = user.id;
  user_email = user.email;
  user_full_name = user.user_metadata.full_name;
  payasguest = false;

  console.log( "user_id: user_email : user_full_name ", user_id , user_email , user_full_name);

  // Check Netlify ID on Faunna DB
  var qc = {"query" : user_id};

  console.log( "getFaunaID started" );

  getFaunaID( qc );

}



function retrieveCustomer ( customerID ) {

  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/retrieveCustomer", {

    method: "POST",

    headers: {
      "Content-Type": "application/json"
    },

    body: JSON.stringify(customerID)

    })
    .then(function(result) {
      return result.json();
    })
    .then(function(data) {
      
      console.log("retrieveCustomer data: ", data);

      console.log("typeof: ", typeof(data));

      stripeAddress( data.Customer );  /// Retrieve Address
      
    }).catch((error) => {

      console.log('error', error);

    });

}



//////////////////
/////////////////
////////////////
///////////////


function updateCustomerStripe ( ) {


  var cartArray = shoppingCart.listCart();

  var purchase = JSON.stringify(cartArray);

  var address = get_address();

  var data = []

  data.push(address);

  data.push(cartArray);

  data.push({ "customerID" : user_stripe_id });

  var resData = JSON.stringify(data);

  console.log("resData...", resData);
  
  
  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/updateCustomer", 
  {

    method: "POST",

    headers: {
      "Content-Type": "application/json"
    },

    body: JSON.stringify(resData)

    })

    .then(function(result) {

      return result.json();

    })

    .then(function(data) {

      console.log("createCustomerStripe data: ", data);

      console.log("typeof: ", typeof(data));

      user_stripe_id = data.Customer.id;

      var dat = { title : user_id ,  key_value: user_stripe_id } ;

      console.log('Creating FaunaID: ', dat);

      createFaunaID(dat);

    
    }).catch((error) => {

      console.log('error', error);

    });

  }



//////////////////
/////////////////
////////////////
///////////////




function createCustomerStripe ( ) {

  var address = get_address();
  
  var data = []
  
  data.push(address);
  
  
  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/createCustomer", {

    method: "POST",

    headers: {
      "Content-Type": "application/json"
    },

    body: JSON.stringify(data)

    })

    .then(function(result) {

      return result.json();

    })

    .then(function(data) {

      console.log("createCustomerStripe data: ", data);

      console.log("typeof: ", typeof(data));

      user_stripe_id = data.Customer.id;

      var dat = { title : user_id ,  key_value: user_stripe_id } ;

      console.log('Creating FaunaID: ', dat);

      createFaunaID(dat);

    
    }).catch((error) => {

      console.log('error', error);

    });

}



function getFaunaID ( user_id ) {

  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/querydatabase", {

    method: "POST",

    headers: {
      "Content-Type": "application/json"
    },

    body: JSON.stringify(user_id)

    })
    .then(function(result) {
      return result.json();
    })
    .then(function(data) {
        
        console.log("incoming data: ", data);
        console.log("typeof: ", typeof(data));
        console.log("data.data: ", data.data );

        //var data = {data: {title: "49c7ffad-fda0-4cc6-a42c-62fa58b860ce", key_value: "cus_HoTewLaPBGI6f0"} } ;
        
        if ( "data" in data )
        {
          

          console.log("data: ", data.data );
          console.log("title: ", data.data.title );
          console.log("key_value: ", data.data.key_value );
          
          var key = data.data.key_value;

          if (key === 'undefined' || key === "" || key === undefined)
          {

            console.log(" data.data in data === true - All Good!!! ");
            createCustomer = true;
            console.log("createCustomer = true");

          }
          else
          {
            console.log(" data.data in data === true but key === undefined ");
            user_stripe_id = key;
            console.log("retrieveCustomer: ", user_stripe_id);
            retrieveCustomer(user_stripe_id);
            createCustomer = false;
          }

        }
        else
        {
            createCustomer = true;
            console.log(" data.data in data === false ");
            console.log("createCustomer = true");
        }
    
    }).catch((error) => {

      console.log('error', error);

    });

}




function createFaunaID ( user_id ) {

  fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/dbCreateDocuments", {

    method: "POST",

    headers: {
      "Content-Type": "application/json"
    },

    body: JSON.stringify(user_id)

    })
    .then(function(result) {
      return result.json();
    })
    .then(function(data) {

      console.log("create Fauna DB: ", data);   

    }).catch((error) => {
      console.log('error', error);
    });

}




function logoutNetlifyIdentity(user) {

  userloggedin = false;
  payasguest = true;
  createCustomer = false;
  user_id = "";
  user_email = "";
  user_stripe_id = "";
  user_full_name = "";

  // Unbind from events
  netlifyIdentity.off('login'); // to unbind all registered handlers
  netlifyIdentity.off('login', loginNetlifyIdentity); // to unbind a single handler
}




var statusNetlify = false;


function netlifyIdentityWidgetopened() {

  statusNetlify = $('#cart').is(':visible');

  if (statusNetlify){
    $('#cart').modal('hide');
  }

}




function netlifyIdentityWidgetclosed() {

  if (statusNetlify)
  {
    $('#cart').modal('show');

    statusNetlify = false;

    if (state === 1){
      vPreviousState();
    }

  }

}




try {

  // netlifyIdentity.open();


  // Get the current user:
  const user = netlifyIdentity.currentUser();


  // Bind to events
  netlifyIdentity.on('login', user => loginNetlifyIdentity(user));

  netlifyIdentity.on('logout', user => logoutNetlifyIdentity(user));

  //////////////
  netlifyIdentity.on('init', user => console.log('init', user));

  netlifyIdentity.on('error', err => console.error('Error', err));

  netlifyIdentity.on('open', () => netlifyIdentityWidgetopened() );

  netlifyIdentity.on('close', () => netlifyIdentityWidgetclosed() );
  /////////////

  // Change language
  netlifyIdentity.setLocale('en');


  // Close the modal
  // netlifyIdentity.close();



}
catch(err) {
  console.log("Some Error")
  console.log(err)
}











////// Stripe Query

// https://api.stripe.com/v1/search?query=vinayak.patel@grynn.in&prefix=false
/*

fetch("https://sleepy-goodall-2e1697.netlify.app/.netlify/functions/queryStripe", {

  method: "POST",

  headers: {
    "Content-Type": "application/json"
  },

  body: JSON.stringify("")

})
  .then(function(result) {
    return result.json();
  })
  .then(function(data) {

    console.log("Query: ", data);   

  }
);

*/







try {



///// Fauna DB /////


//q = faunadb.query;


//var serverClient = new faunadb.Client({ secret: '' });


/*


serverClient.query(
  faunadb.query.Create(
    faunadb.query.Collection('grynntable'),
    { data: { title: 'What I had for breakfast ..' } },
  )
)
.then((ret) => console.log(ret))



serverClient.query(
  q.Get(
    q.Match(q.Index('posts_by_title'), 'What I had for breakfast ..')
  )
)
.then((ret) => console.log(ret))



serverClient.query(
  q.Update(
    q.Ref(q.Collection('grynntable'), '273181600287556102'),
    { data: { title: 'Vinayak is the best programmer...' } },
  )
)
.then((ret) => console.log(ret))



serverClient.query(
  q.Get(q.Ref(q.Collection('grynntable'), '273181600287556102'))
)
.then((ret) => console.log(ret))



serverClient.query(
  q.CreateIndex({
    name: 'posts_by_title',
    source: q.Collection('grynntable'),
    terms: [{ field: ['data', 'title'] }],
  })
)
.then((ret) => console.log(ret))



serverClient.query(
  q.Create(
    q.Collection('grynntable'),
    { data: { title: 'What I had for breakfast ..' } },
  )
)
.then((ret) => console.log(ret))



serverClient.query(
  q.Create(
    q.Collection('grynntable'),
    { data: { title : '123456789' ,  key_value: 'some value is 123456789'} },
  )
)
.then((ret) => console.log(ret))



serverClient.query(
  q.Get(
    q.Match(q.Index('posts_by_title'), '123456789')
  )
)
.then((ret) => console.log(ret))




serverClient.query(
  q.Create(
    q.Collection('grynntable'),
    { data: { title : 'netlify_ID deepak grynn' ,  key_value: 'stripe_ID deepak strip 12356790'} },
  )
)
.then((ret) => console.log(ret))





serverClient.query(
  q.Get(
    q.Match(q.Index('posts_by_title'), 'vinayak')
  )
)
.then((ret) => console.log(ret))




serverClient.query(
  q.Create(
    q.Collection('grynntable'),
    { data: { title : '123456789' ,  key_value: 'some value is 123456789'} },
  )
)
.then((ret) => console.log(ret))


serverClient.query(
  q.Get(
    q.Match(q.Index('posts_by_title'), '123456789')
  )
)
.then((ret) => console.log(ret))



*/



}
catch(err) {
  console.log("Some Error")
  console.log(err)
}


</script>



</body>



</html>
